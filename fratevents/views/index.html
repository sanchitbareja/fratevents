<!DOCTYPE html>
<html>
  <head>
  	{% load static %}{% get_static_prefix as STATIC_URL %}
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>

	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="HandheldFriendly" content="true">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/styles.css" media="all">
	<link rel="alternate stylesheet" type="text/css" href="{{ STATIC_URL }}js/responsive.css" media="all">

	<!--jQuery-->
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>

    <!--Google maps API -->
    <!--<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyD8tgnC9UWlAbebHZm7iHBMH_8B2bd1ork&sensor=false"></script>-->
    <script type="text/javascript">
		var map;

      	function initialize() {
		  	var mapCenter = new google.maps.LatLng(37.87201, -122.25775);		
			var mapOptions = {
			    zoom: 15,
			    mapTypeId: google.maps.MapTypeId.ROADMAP,
			    center: mapCenter
			};
			
			var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

			//get all the events from the database
			$.get('get/events/',function(data){
				console.log(data);
				//add coordinates to list and add markers + map formatting
				for(var event in data['events']){
					console.log(new Date(data['events'][event]['startTime']*1000+72000000-1));
					console.log(new Date(data['events'][event]['endTime']*1000+72000000-1));
					//$("#items").append("name:   "+data['friends'][friend]['name']+"    fb_id:   "+data['friends'][friend]['fb_id']+"<br />");
					var newMarkerPos = new google.maps.LatLng(data['events'][event]['lat'], data['events'][event]['lng']);
					var marker = new google.maps.Marker({
					    map:map,
					    draggable:true,
					    animation: google.maps.Animation.DROP,
					    position: newMarkerPos,
					    title:data['events'][event]['title']
					});

					//Add into sidebar list
					var oldul = document.querySelectorAll("#nlists")[0];
					var newa = document.createElement("a");
					newa.appendChild(document.createTextNode(marker.getTitle()));
					var newli = document.createElement("li");

					// newli.className = "head";
					newli.appendChild(newa);
					oldul.appendChild(newli);

					attachEventsToMarkers(marker,data['events'][event]['title'],data['events'][event]['lat'],data['events'][event]['lng'],newli);

				}
			});
			/* FOR SCROLL EFFECTS */
			var lists = document.querySelectorAll('#nlists ul');

			function attachEventsToMarkers(marker,eventName,eventLat,eventLng,newli){
				var contentInfo = '<p style="text-align:center;">'+eventName+'</p><br />Latitude: '+eventLat+'</br>Longitude: '+eventLng;

				var infowindow = new google.maps.InfoWindow({
				    content: contentInfo
				});

				//handling what happens when marker is clicked
				function toggleClick() {
					infowindow.open(map,marker);
				}

				function toggleBounce() {
					if(marker.getAnimation() == null){
						marker.setAnimation(google.maps.Animation.BOUNCE);
					} else {
						marker.setAnimation(null);
					}
				}

				//add listner to the marker
				google.maps.event.addListener(marker, 'click', function(){ infowindow.open(map,marker); });

				//attaching events to list items in sidebar
				google.maps.event.addDomListener(newli,'click', toggleClick);
				google.maps.event.addDomListener(newli,'mouseover', toggleBounce);
				google.maps.event.addDomListener(newli,'mouseout', toggleBounce);

			}
		}

		function loadScript() {
			var script = document.createElement("script");
			script.type = "text/javascript";
			script.src = "http://maps.googleapis.com/maps/api/js?key=AIzaSyD8tgnC9UWlAbebHZm7iHBMH_8B2bd1ork&sensor=true&callback=initialize";
		  	document.body.appendChild(script);
		}

		window.onload = loadScript;
    </script>
</head>
<body>
  	<div style="width:100%; height:100%;">
  		<div id="sidebar" style="width:25%; height:100%; float:left; text-align:center;">
  			<h1>Map of the Events</h1>
			<section id="content">				
				<nav>
					<ul id="nlists">
						<li class="head">24th August 2012</li>						
					</ul>
				</nav>
			</section>
  		</div>
	    <div id="map_canvas" style="width:75%; height:100%; float:left;"></div>
	</div>

	<!--Scroll effects-->
	<script type="text/javascript">
	</script>
  </body>
</html>